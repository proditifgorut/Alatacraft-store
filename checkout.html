<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Nusantara Eceng</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/style.css">
    
    <style>
        .checkout-header {
            background: linear-gradient(135deg, var(--bs-primary), var(--bs-secondary));
            color: white;
            padding: 2rem 0;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin: 0 1rem;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        .step.active .step-number {
            background: var(--bs-primary);
            color: white;
        }
        
        .step.completed .step-number {
            background: var(--bs-success);
            color: white;
        }
        
        .step::after {
            content: '';
            width: 100px;
            height: 2px;
            background: #e9ecef;
            margin-left: 1rem;
        }
        
        .step:last-child::after {
            display: none;
        }
        
        .step.completed::after {
            background: var(--bs-success);
        }
        
        .product-summary {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .payment-method {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-method:hover {
            border-color: var(--bs-primary);
        }
        
        .payment-method.selected {
            border-color: var(--bs-primary);
            background: rgba(139, 69, 19, 0.05);
        }
        
        .qris-section {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .qris-code {
            width: 250px;
            height: 250px;
            margin: 1rem auto;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f8f9fa"/><text x="50" y="55" text-anchor="middle" font-size="12" fill="%236c757d">QR Code QRIS</text></svg>') center/contain no-repeat;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .order-summary {
            background: var(--cream);
            border-radius: 12px;
            padding: 1.5rem;
            position: sticky;
            top: 100px;
        }
        
        @media (max-width: 768px) {
            .step-indicator {
                overflow-x: auto;
            }
            
            .step::after {
                width: 50px;
            }
            
            .order-summary {
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top navbar-custom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=80&h=80&fit=crop&crop=center" alt="Nusantara Eceng Logo" class="logo-img me-2">
                <span class="brand-text">Nusantara Eceng</span>
            </a>
            
            <div class="d-flex align-items-center">
                <span class="badge bg-success me-3">Checkout Aman</span>
                <a href="/" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </a>
            </div>
        </div>
    </nav>

    <!-- Checkout Header -->
    <div class="checkout-header mt-5 pt-3">
        <div class="container text-center">
            <h2 class="mb-2">Checkout Pesanan</h2>
            <p class="mb-0">Selesaikan pembelian Anda dengan aman dan mudah</p>
        </div>
    </div>

    <!-- Step Indicator -->
    <div class="container">
        <div class="step-indicator">
            <div class="step completed">
                <div class="step-number">1</div>
                <span>Produk</span>
            </div>
            <div class="step active">
                <div class="step-number">2</div>
                <span>Alamat</span>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <span>Pembayaran</span>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <span>Konfirmasi</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mb-5">
        <div class="row">
            <!-- Checkout Form -->
            <div class="col-lg-8">
                <!-- Step 1: Product Summary -->
                <div class="checkout-step" id="step-1">
                    <div class="product-summary">
                        <h5 class="mb-3">
                            <i class="bi bi-cart-check me-2"></i>Ringkasan Produk
                        </h5>
                        <div id="productItems">
                            <!-- Product items will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Step 2: Shipping Address -->
                <div class="checkout-step" id="step-2">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">
                                <i class="bi bi-geo-alt me-2"></i>Alamat Pengiriman
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="fullName" class="form-label">Nama Lengkap</label>
                                    <input type="text" class="form-control" id="fullName" value="Ahmad Rizki" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="phoneNumber" class="form-label">Nomor Telepon</label>
                                    <input type="tel" class="form-control" id="phoneNumber" value="+62 812-3456-7890" required>
                                </div>
                                <div class="col-12">
                                    <label for="address" class="form-label">Alamat Lengkap</label>
                                    <textarea class="form-control" id="address" rows="3" required>Jl. Sudirman No. 123, RT 02/RW 05, Kelurahan Menteng</textarea>
                                </div>
                                <div class="col-md-4">
                                    <label for="city" class="form-label">Kota</label>
                                    <input type="text" class="form-control" id="city" value="Jakarta Pusat" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="state" class="form-label">Provinsi</label>
                                    <input type="text" class="form-control" id="state" value="DKI Jakarta" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="postalCode" class="form-label">Kode Pos</label>
                                    <input type="text" class="form-control" id="postalCode" value="10310" required>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h6>Metode Pengiriman</h6>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="shipping" id="regular" value="regular" checked>
                                    <label class="form-check-label" for="regular">
                                        <div class="d-flex justify-content-between">
                                            <span>Reguler (3-5 hari kerja)</span>
                                            <strong>Rp 15.000</strong>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="shipping" id="express" value="express">
                                    <label class="form-check-label" for="express">
                                        <div class="d-flex justify-content-between">
                                            <span>Express (1-2 hari kerja)</span>
                                            <strong>Rp 25.000</strong>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Payment Method -->
                <div class="checkout-step" id="step-3" style="display: none;">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">
                                <i class="bi bi-credit-card me-2"></i>Metode Pembayaran
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="payment-method selected" data-method="qris">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        <i class="bi bi-qr-code display-6 text-primary"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">QRIS (Quick Response Code Indonesian Standard)</h6>
                                        <p class="text-muted mb-0">Pembayaran instan dengan semua bank dan e-wallet</p>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="payment" value="qris" checked>
                                    </div>
                                </div>
                            </div>

                            <div class="payment-method" data-method="bank">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        <i class="bi bi-bank display-6 text-success"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">Transfer Bank</h6>
                                        <p class="text-muted mb-0">Transfer manual ke rekening perusahaan</p>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="payment" value="bank">
                                    </div>
                                </div>
                            </div>

                            <div class="payment-method" data-method="cod">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        <i class="bi bi-cash display-6 text-warning"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">Cash on Delivery (COD)</h6>
                                        <p class="text-muted mb-0">Bayar saat produk sampai di tempat Anda</p>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="payment" value="cod">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: QRIS Payment -->
                <div class="checkout-step" id="step-4" style="display: none;">
                    <div class="qris-section">
                        <h5 class="mb-3">Scan QR Code untuk Pembayaran</h5>
                        <div class="qris-code"></div>
                        <p class="text-muted mb-3">Scan menggunakan aplikasi mobile banking atau e-wallet favorit Anda</p>
                        
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Total Pembayaran: <span id="totalPayment">Rp 165.000</span></strong>
                        </div>
                        
                        <div class="d-flex justify-content-center gap-2 mb-3">
                            <img src="https://via.placeholder.com/50x30/0066cc/ffffff?text=BCA" alt="BCA" class="rounded">
                            <img src="https://via.placeholder.com/50x30/ff6600/ffffff?text=BRI" alt="BRI" class="rounded">
                            <img src="https://via.placeholder.com/50x30/004d9f/ffffff?text=BNI" alt="BNI" class="rounded">
                            <img src="https://via.placeholder.com/50x30/00aa13/ffffff?text=GRAB" alt="Grab" class="rounded">
                            <img src="https://via.placeholder.com/50x30/0066ff/ffffff?text=OVO" alt="OVO" class="rounded">
                            <img src="https://via.placeholder.com/50x30/ff4757/ffffff?text=DANA" alt="Dana" class="rounded">
                        </div>
                        
                        <button class="btn btn-primary btn-lg" id="confirmPayment">
                            <i class="bi bi-check-circle me-2"></i>Konfirmasi Pembayaran
                        </button>
                        
                        <p class="small text-muted mt-3">
                            Setelah transfer, klik "Konfirmasi Pembayaran" untuk melanjutkan proses pesanan
                        </p>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <button class="btn btn-outline-secondary" id="prevStep" style="display: none;">
                        <i class="bi bi-arrow-left me-2"></i>Kembali
                    </button>
                    <button class="btn btn-primary ms-auto" id="nextStep">
                        Lanjutkan <i class="bi bi-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
                <div class="order-summary">
                    <h5 class="mb-3">
                        <i class="bi bi-receipt me-2"></i>Ringkasan Pesanan
                    </h5>
                    
                    <div class="order-item mb-3" id="orderSummary">
                        <!-- Order summary will be populated here -->
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal</span>
                        <span id="subtotal">Rp 150.000</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Ongkos Kirim</span>
                        <span id="shippingCost">Rp 15.000</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Pajak</span>
                        <span id="tax">Rp 0</span>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between fw-bold h5">
                        <span>Total</span>
                        <span id="total" class="text-success">Rp 165.000</span>
                    </div>
                    
                    <div class="mt-3">
                        <div class="d-flex align-items-center text-success mb-2">
                            <i class="bi bi-shield-check me-2"></i>
                            <small>Transaksi 100% Aman</small>
                        </div>
                        <div class="d-flex align-items-center text-success mb-2">
                            <i class="bi bi-truck me-2"></i>
                            <small>Garansi Pengiriman</small>
                        </div>
                        <div class="d-flex align-items-center text-success">
                            <i class="bi bi-arrow-repeat me-2"></i>
                            <small>Kebijakan Retur 7 Hari</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-5">
                    <div class="mb-4">
                        <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
                    </div>
                    <h3 class="mb-3">Pembayaran Berhasil!</h3>
                    <p class="text-muted mb-4">
                        Terima kasih atas pembelian Anda!<br>
                        Pesanan Anda akan segera diproses dan dikirim.
                    </p>
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" onclick="printReceipt()">
                            <i class="bi bi-printer me-2"></i>Cetak Struk
                        </button>
                        <button class="btn btn-outline-primary" onclick="goToOrderTracking()">
                            <i class="bi bi-truck me-2"></i>Lacak Pesanan
                        </button>
                        <button class="btn btn-outline-secondary" onclick="continueShopping()">
                            Lanjut Berbelanja
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        class CheckoutProcess {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 4;
                this.orderData = this.getOrderData();
                
                this.initializeCheckout();
                this.setupEventListeners();
                this.populateOrderData();
            }

            getOrderData() {
                // Get order data from URL or localStorage
                const urlParams = new URLSearchParams(window.location.search);
                const orderId = urlParams.get('order');
                
                // Mock order data - in real app, fetch from API
                return {
                    id: orderId || 'ORD-' + Date.now(),
                    items: [
                        {
                            id: 1,
                            name: 'Tas Anyam Premium',
                            price: 150000,
                            quantity: 1,
                            image: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=80&h=80&fit=crop',
                            artisan: 'Ibu Sari - Yogyakarta'
                        }
                    ],
                    subtotal: 150000,
                    shipping: 15000,
                    tax: 0,
                    total: 165000
                };
            }

            initializeCheckout() {
                this.updateStepIndicator();
                this.showStep(this.currentStep);
            }

            setupEventListeners() {
                // Navigation buttons
                document.getElementById('nextStep').addEventListener('click', () => {
                    this.nextStep();
                });

                document.getElementById('prevStep').addEventListener('click', () => {
                    this.prevStep();
                });

                // Payment method selection
                document.querySelectorAll('.payment-method').forEach(method => {
                    method.addEventListener('click', () => {
                        document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                        method.classList.add('selected');
                        method.querySelector('input[type="radio"]').checked = true;
                    });
                });

                // Shipping method change
                document.querySelectorAll('input[name="shipping"]').forEach(radio => {
                    radio.addEventListener('change', () => {
                        this.updateShippingCost();
                    });
                });

                // Confirm payment
                document.getElementById('confirmPayment').addEventListener('click', () => {
                    this.processPayment();
                });
            }

            populateOrderData() {
                // Populate product items
                const productItems = document.getElementById('productItems');
                productItems.innerHTML = this.orderData.items.map(item => `
                    <div class="d-flex align-items-center border-bottom pb-3 mb-3">
                        <img src="${item.image}" alt="${item.name}" class="rounded me-3" width="60" height="60">
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${item.name}</h6>
                            <p class="text-muted mb-1 small">${item.artisan}</p>
                            <span class="badge bg-primary">Qty: ${item.quantity}</span>
                        </div>
                        <div class="text-end">
                            <div class="fw-semibold">Rp ${item.price.toLocaleString('id-ID')}</div>
                        </div>
                    </div>
                `).join('');

                // Populate order summary
                const orderSummary = document.getElementById('orderSummary');
                orderSummary.innerHTML = this.orderData.items.map(item => `
                    <div class="d-flex justify-content-between mb-2">
                        <span class="small">${item.name} (${item.quantity}x)</span>
                        <span class="small">Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</span>
                    </div>
                `).join('');

                this.updateTotals();
            }

            updateTotals() {
                document.getElementById('subtotal').textContent = `Rp ${this.orderData.subtotal.toLocaleString('id-ID')}`;
                document.getElementById('shippingCost').textContent = `Rp ${this.orderData.shipping.toLocaleString('id-ID')}`;
                document.getElementById('tax').textContent = `Rp ${this.orderData.tax.toLocaleString('id-ID')}`;
                document.getElementById('total').textContent = `Rp ${this.orderData.total.toLocaleString('id-ID')}`;
                document.getElementById('totalPayment').textContent = `Rp ${this.orderData.total.toLocaleString('id-ID')}`;
            }

            updateShippingCost() {
                const selectedShipping = document.querySelector('input[name="shipping"]:checked').value;
                this.orderData.shipping = selectedShipping === 'express' ? 25000 : 15000;
                this.orderData.total = this.orderData.subtotal + this.orderData.shipping + this.orderData.tax;
                this.updateTotals();
            }

            nextStep() {
                if (this.validateCurrentStep()) {
                    if (this.currentStep < this.totalSteps) {
                        this.currentStep++;
                        this.updateStepIndicator();
                        this.showStep(this.currentStep);
                    }
                }
            }

            prevStep() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.updateStepIndicator();
                    this.showStep(this.currentStep);
                }
            }

            validateCurrentStep() {
                switch(this.currentStep) {
                    case 1:
                        return true; // Product step is always valid
                    case 2:
                        return this.validateAddressForm();
                    case 3:
                        return document.querySelector('input[name="payment"]:checked') !== null;
                    default:
                        return true;
                }
            }

            validateAddressForm() {
                const requiredFields = ['fullName', 'phoneNumber', 'address', 'city', 'state', 'postalCode'];
                return requiredFields.every(field => {
                    const element = document.getElementById(field);
                    if (!element.value.trim()) {
                        element.classList.add('is-invalid');
                        return false;
                    }
                    element.classList.remove('is-invalid');
                    return true;
                });
            }

            updateStepIndicator() {
                document.querySelectorAll('.step').forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index + 1 < this.currentStep) {
                        step.classList.add('completed');
                    } else if (index + 1 === this.currentStep) {
                        step.classList.add('active');
                    }
                });
            }

            showStep(stepNumber) {
                // Hide all steps
                document.querySelectorAll('.checkout-step').forEach(step => {
                    step.style.display = 'none';
                });

                // Show current step
                const currentStepElement = document.getElementById(`step-${stepNumber}`);
                if (currentStepElement) {
                    currentStepElement.style.display = 'block';
                }

                // Update navigation buttons
                const prevBtn = document.getElementById('prevStep');
                const nextBtn = document.getElementById('nextStep');

                if (stepNumber === 1) {
                    prevBtn.style.display = 'none';
                } else {
                    prevBtn.style.display = 'block';
                }

                if (stepNumber === this.totalSteps) {
                    nextBtn.style.display = 'none';
                } else {
                    nextBtn.style.display = 'block';
                    nextBtn.innerHTML = stepNumber === 3 ? 'Bayar Sekarang <i class="bi bi-arrow-right ms-2"></i>' : 'Lanjutkan <i class="bi bi-arrow-right ms-2"></i>';
                }
            }

            async processPayment() {
                // Show loading
                const confirmBtn = document.getElementById('confirmPayment');
                const originalText = confirmBtn.innerHTML;
                confirmBtn.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>Memproses...';
                confirmBtn.disabled = true;

                try {
                    // Simulate payment processing
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // Show success modal
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    
                } catch (error) {
                    alert('Terjadi kesalahan saat memproses pembayaran. Silakan coba lagi.');
                } finally {
                    confirmBtn.innerHTML = originalText;
                    confirmBtn.disabled = false;
                }
            }
        }

        // Initialize checkout process
        document.addEventListener('DOMContentLoaded', () => {
            new CheckoutProcess();
        });

        // Global functions for modal actions
        function printReceipt() {
            const orderId = new CheckoutProcess().orderData.id;
            window.open(`/receipt.html?order=${orderId}`, '_blank');
        }

        function goToOrderTracking() {
            window.location.href = '/user-dashboard.html?section=orders';
        }

        function continueShopping() {
            window.location.href = '/';
        }
    </script>
</body>
</html>
